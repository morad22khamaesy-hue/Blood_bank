{% extends "blood/base.html" %}
{% block title %}Dispense - Blood Bank{% endblock %}
{% block content %}
  <div class="row g-4">
    <div class="col-lg-7">
      <div class="card">
        <div class="card-body">
          <h2 class="h4 mb-3" style="color:var(--bb-text)">Dispense Units</h2>
          <form method="post" class="row g-3" novalidate>
            {% csrf_token %}

            <div class="col-md-6">
              <label class="form-label" for="id_blood_type">Requested blood type</label>
              {{ form.blood_type }}
              {% if form.blood_type.errors %}
                <div class="invalid-feedback d-block">{{ form.blood_type.errors.0 }}</div>
              {% endif %}
            </div>

            <div class="col-md-6">
              <label class="form-label" for="id_quantity">Quantity</label>
              {{ form.quantity }}
              {% if form.quantity.errors %}
                <div class="invalid-feedback d-block">{{ form.quantity.errors.0 }}</div>
              {% endif %}
            </div>

            <div class="col-12">
              <button type="submit" class="btn btn-bb">Dispense</button>
            </div>
          </form>

          {% if result %}
            <div class="alert alert-info mt-3"><strong>{{ result }}</strong></div>
          {% endif %}
        </div>
      </div>
    </div>

    {% if plan %}
      <div class="col-lg-5">
        <div class="card h-100">
          <div class="card-body">
            <h3 class="h5 mb-3">Dispense Plan</h3>
            <!-- בהיר: table-striped במקום table-dark -->
            <table class="table table-sm table-striped align-middle">
              <thead>
                <tr>
                  <th class="text-muted">Blood type</th>
                  <th class="text-muted">Units</th>
                </tr>
              </thead>
              <tbody>
                {% for dtype, amount in plan.items %}
                  <tr>
                    <td><span class="badge bg-danger-subtle text-danger-emphasis">{{ dtype }}</span></td>
                    <td><span class="badge bg-secondary-subtle text-secondary-emphasis">{{ amount }}</span></td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
            <p class="mb-0 small" style="color:var(--bb-muted)">
              The plan follows RBC compatibility priority for the requested recipient type.
            </p>
          </div>
        </div>
      </div>
    {% endif %}
  </div>
{% endblock %}
