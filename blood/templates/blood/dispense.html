{% extends "blood/base.html" %}
{% block title %}Dispense - Blood Bank{% endblock %}
{% block content %}

  <section class="mb-4 p-4 p-md-5 rounded-4 border" style="background:linear-gradient(135deg,#fff, #fafbff); border-color:#e5e7eb">
    <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
      <div>
        <h1 class="h3 mb-1">Request blood units</h1>
        <p class="mb-0 text-muted">Select urgency, hospital and the requested units. The request will be sent to the manager for approval.</p>
      </div>
    </div>
  </section>

  <div class="row g-4 align-items-start">
    <div class="col-12 col-lg-8">
      <div class="card shadow-sm rounded-4">
        <div class="card-body p-4 p-md-5">

          <form method="post" novalidate>
            {% csrf_token %}

            <!-- Urgency -->
            <div class="mb-4">
              <label class="form-label fw-semibold d-block mb-2">Urgency</label>
              <div class="btn-group" role="group" aria-label="Urgency">
                <input type="radio" class="btn-check" name="urgency" id="urg-regular" value="REGULAR"
                       {% if form.urgency.value != "URGENT" %}checked{% endif %}>
                <label class="btn btn-outline-secondary" for="urg-regular">Regular</label>

                <input type="radio" class="btn-check" name="urgency" id="urg-urgent" value="URGENT"
                       {% if form.urgency.value == "URGENT" %}checked{% endif %}>
                <label class="btn btn-outline-danger" for="urg-urgent">Urgent</label>
              </div>
              <div class="form-text">Urgent requests are highlighted to the manager.</div>
              {% if form.urgency.errors %}
                <div class="invalid-feedback d-block">{{ form.urgency.errors.0 }}</div>
              {% endif %}
            </div>

            <!-- Hospital -->
            <div class="mb-4">
              <label class="form-label fw-semibold" for="id_hospital">Hospital (name — city)</label>
              <select class="form-select" id="id_hospital" name="hospital">
                {% for val,label in form.hospital.field.choices %}
                  <option value="{{ val }}" {% if form.hospital.value == val %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
              </select>
              {% if form.hospital.errors %}
                <div class="invalid-feedback d-block">{{ form.hospital.errors.0 }}</div>
              {% endif %}
            </div>

            <!-- Blood type + Quantity -->
            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <label class="form-label fw-semibold" for="id_blood_type">Requested blood type</label>
                <select class="form-select" id="id_blood_type" name="blood_type">
                  {% for val,label in form.blood_type.field.choices %}
                    <option value="{{ val }}" {% if form.blood_type.value == val %}selected{% endif %}>{{ label }}</option>
                  {% endfor %}
                </select>
                {% if form.blood_type.errors %}
                  <div class="invalid-feedback d-block">{{ form.blood_type.errors.0 }}</div>
                {% endif %}
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold" for="id_quantity">Quantity</label>
                <input type="number" min="1" class="form-control" id="id_quantity" name="quantity"
                       value="{{ form.quantity.value|default_if_none:'' }}" placeholder="e.g., 3">
                {% if form.quantity.errors %}
                  <div class="invalid-feedback d-block">{{ form.quantity.errors.0 }}</div>
                {% endif %}
              </div>
            </div>

            <!-- Notes -->
            <div class="mb-4">
              <label class="form-label fw-semibold" for="id_notes">Notes (optional)</label>
              <textarea class="form-control" id="id_notes" name="notes" rows="3"
                        placeholder="Clinical details, contact person, delivery timing…">{{ form.notes.value|default_if_none:'' }}</textarea>
              {% if form.notes.errors %}
                <div class="invalid-feedback d-block">{{ form.notes.errors.0 }}</div>
              {% endif %}
            </div>

            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-bb px-4">Submit request</button>
              <a href="{% url 'home' %}" class="btn btn-outline-secondary">Cancel</a>
            </div>
          </form>

        </div>
      </div>
    </div>

    <!-- Side panel: clean, helpful, not cluttered -->
    <div class="col-12 col-lg-4">
      <div class="card shadow-sm rounded-4">
        <div class="card-body p-4">
          <h6 class="text-uppercase text-muted mb-3">Quick tips</h6>
          <ul class="list-unstyled small mb-0">
            <li class="mb-2">Choose the exact <strong>hospital</strong> for accurate dispatch.</li>
            <li class="mb-2"><strong>Urgent</strong> requests appear with a red badge to the manager.</li>
            <li class="mb-0">Stock is allocated on approval using compatibility + FEFO (closest expiry first).</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

{% endblock %}
