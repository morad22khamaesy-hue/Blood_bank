<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <title>{% block title %}Blood Bank{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

  <style>
    :root{
      /* Core palette (light theme) */
      --bb-primary: #B91C1C;      /* blood red */
      --bb-primary-700:#991B1B;
      --bb-accent:  #F59E0B;      /* amber for near-expiry */
      --bb-success: #16A34A;      /* available / success */
      --bb-text:    #111827;      /* gray-900 */
      --bb-muted:   #6B7280;      /* gray-500 */
      --bb-bg:      #F8FAFC;      /* slate-50 */
      --bb-surface: #FFFFFF;      /* cards */
      --bb-border:  #E5E7EB;      /* gray-200 */
    }

    html,body{background: radial-gradient(1100px 600px at 5% -10%, #fff 0, var(--bb-bg) 60%) fixed; color:var(--bb-text);}
    a{color:var(--bb-primary)}
    a:hover{color:var(--bb-primary-700)}

    /* Navbar - light */
    .navbar{background: var(--bb-surface); border-bottom:1px solid var(--bb-border)}
    .navbar .navbar-brand{color:var(--bb-primary); font-weight:600}
    .navbar .nav-link{color:var(--bb-text)}
    .navbar .nav-link.active{color:var(--bb-primary); border-bottom:2px solid var(--bb-primary)}
    .navbar .nav-link:hover{color:var(--bb-primary)}

    main.container{max-width:1100px}

    /* Cards / tables */
    .card{background: var(--bb-surface); border:1px solid var(--bb-border); color:var(--bb-text); box-shadow:0 6px 20px rgba(0,0,0,.06)}
    .card .card-title{color:var(--bb-text)}
    .table thead th{border-bottom:1px solid var(--bb-border)}
    .table-striped>tbody>tr:nth-of-type(odd)>*{background-color: rgba(0,0,0,.02);}
    .badge-soft{background: #FEE2E2; color:#991B1B; border:1px solid #FECACA;}

    /* Buttons */
    .btn-bb{
      --bs-btn-bg: var(--bb-primary);
      --bs-btn-border-color: var(--bb-primary);
      --bs-btn-hover-bg: var(--bb-primary-700);
      --bs-btn-hover-border-color: var(--bb-primary-700);
      --bs-btn-active-bg: var(--bb-primary-700);
      --bs-btn-active-border-color: var(--bb-primary-700);
      --bs-btn-color:#fff;
    }

    /* Forms */
    .form-label{color:#374151}
    .form-control, .form-select{
      background:#fff; color:var(--bb-text); border:1px solid var(--bb-border);
    }
    .form-control:focus,.form-select:focus{
      border-color:var(--bb-primary); box-shadow:0 0 0 .2rem rgba(185,28,28,.15);
    }
    .form-text{color:var(--bb-muted)}
    .is-invalid{border-color:#DC2626!important}
    .invalid-feedback{display:block}

    ul.errorlist{margin:.25rem 0 0; padding-left:1rem; color:#B91C1C}
    ul.errorlist li{list-style:"âš   " outside; margin-left:.25rem}

    .alert{border:1px solid var(--bb-border)}
    .alert-info{background:#EFF6FF;color:#0C4A6E}

    footer{color:var(--bb-muted)}
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand" href="/">ðŸ©¸ Blood Bank</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav"
              aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div id="nav" class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link {% if request.resolver_match.url_name == 'home' %}active{% endif %}" href="/">Home</a></li>
          <li class="nav-item"><a class="nav-link {% if request.resolver_match.url_name == 'intake' %}active{% endif %}" href="{% url 'intake' %}">Intake</a></li>
          <li class="nav-item"><a class="nav-link {% if request.resolver_match.url_name == 'dispense' %}active{% endif %}" href="{% url 'dispense' %}">Dispense</a></li>
          <li class="nav-item"><a class="nav-link {% if request.resolver_match.url_name == 'donations_list' %}active{% endif %}" href="{% url 'donations_list' %}">Donations</a></li>
          <li class="nav-item"><a class="nav-link {% if request.resolver_match.url_name == 'inventory' %}active{% endif %}" href="{% url 'inventory' %}">Inventory</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Flash messages -->
  <div class="container mt-3">
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    {% endif %}
  </div>

  <!-- Page content -->
  <main class="container py-4">
    {% block content %}{% endblock %}
  </main>

  <footer class="container py-4 small">
    <span>&copy; {% now "Y" %} Blood Bank â€” built with Django &amp; Bootstrap</span>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
          crossorigin="anonymous"></script>

  <!-- Client-side input guards -->
  <script>
    (function () {
      document.addEventListener('input', function (e) {
        var el = e.target;
        if (el.classList && el.classList.contains('js-digits-only')) {
          var v = (el.value || '').replace(/\D+/g, '');
          var max = el.getAttribute('maxlength');
          if (max) v = v.slice(0, parseInt(max, 10));
          el.value = v;
        }
      });
      function sanitizeLettersAnyLang(s) {
        try { return s.replace(/[^\p{L}\s'-]+/gu, ''); }
        catch (err) { return s.replace(/[^A-Za-z\s'-]+/g, ''); }
      }
      document.addEventListener('input', function (e) {
        var el = e.target;
        if (el.classList && el.classList.contains('js-letters-only')) {
          var before = el.value || '';
          var after = sanitizeLettersAnyLang(before);
          if (after !== before) {
            el.value = after;
            try { el.setSelectionRange(after.length, after.length); } catch (_){}
          }
        }
      });
      document.addEventListener('paste', function (e) {
        var el = e.target;
        if (!(el.classList && (el.classList.contains('js-digits-only') || el.classList.contains('js-letters-only')))) return;
        e.preventDefault();
        var text = (e.clipboardData || window.clipboardData).getData('text') || '';
        if (el.classList.contains('js-digits-only')) {
          text = text.replace(/\D+/g, '');
          var max = el.getAttribute('maxlength');
          if (max) text = text.slice(0, parseInt(max, 10));
        } else {
          text = sanitizeLettersAnyLang(text);
        }
        var start = el.selectionStart, end = el.selectionEnd, val = el.value || '';
        el.value = val.slice(0, start) + text + val.slice(end);
        var newPos = start + text.length;
        try { el.setSelectionRange(newPos, newPos); } catch (_){}
      });
    })();
  </script>
</body>
</html>
